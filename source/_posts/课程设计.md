---
title: è¯¾ç¨‹è®¾è®¡
date: 2021-05-25 19:05:03
categories:	å¼€å‘
tags: C++
---
> C++ç»“è¯¾ä½œä¸šï¼Œç¬¬ä¸€æ¬¡æäº†è¿™ä¹ˆé•¿çš„ä»£ç (è™½ç„¶å·¨å¤šbugï¼Œè¿˜æœ‰æ°´è¡Œæ•°çš„å«Œç–‘
> ä¼ ä¸Šæ¥ç©ç©ğŸ™
<!--more-->

# å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ
## main.cpp
```
//*****************************å›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ***********************************
//è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯å­¦é™¢/äººå·¥æ™ºèƒ½å­¦é™¢
//162020113 æåšè½©
#include <iostream>
#include <stdlib.h>
#include <fstream>
#include <cstring>

#include "basic.h"
#include "manage.h"
using namespace std;

int main() {
	cout << "________________________________________________________________________" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|                      æ¬¢è¿æ¥åˆ°NUAAå›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿ			|" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|----------------------------------------------------------------------|" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|               è¯·é€‰æ‹©æ‚¨çš„èº«ä»½(å­¦ç”Ÿ-S/æ•™å¸ˆ-T/ç®¡ç†-A)			|" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|                                                                      |" << endl;
	cout << "|______________________________________________________________________|" << endl;
	Students student;
	Teachers teacher;
	Manage manager;

	char judge_identity;
	//é€‰æ‹©èº«ä»½
	char judge1;
	//é€‰æ‹©æ³¨å†Œ/ç™»å½•
	while (1) {
		cout << "è¯·é€‰æ‹©èº«ä»½:\t";
		cin >> judge_identity;
		cin.ignore();
		switch (judge_identity) {
			case 'S': {
				while (1) {
					cout << "æ³¨å†Œ/ç™»å½•(R/L):\t";
					cin >> judge1;
					cin.ignore();
					if (judge1 == 'R' || judge1 == 'r')
						student.registered();
					else if (judge1 == 'L' || judge1 == 'l')
						student.login();
					else
						cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥" << endl;
				}
				break;
			}
			case 's': {
				while (1) {
					cout << "æ³¨å†Œ/ç™»å½•(R/L):\t";
					cin >> judge1;
					cin.ignore();
					if (judge1 == 'R' || judge1 == 'r')
						student.registered();
					else if (judge1 == 'L' || judge1 == 'l')
						student.login();
					else
						cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥" << endl;
				}
				break;
			}
			case 'T': {
				while (1) {
					cout << "æ³¨å†Œ/ç™»å½•(R/L):\t";
					cin >> judge1;
					cin.ignore();
					if (judge1 == 'R' || judge1 == 'r')
						teacher.registered();
					else if (judge1 == 'L' || judge1 == 'l')
						teacher.login();
					else
						cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥" << endl;
				}
				break;
			}
			case 't': {
				cout << "æ³¨å†Œ/ç™»å½•(R/L):\t";
				cin >> judge1;
				cin.ignore();
				if (judge1 == 'R' || judge1 == 'r')
					teacher.registered();
				else if (judge1 == 'L' || judge1 == 'l')
					teacher.login();
				break;
			}
			case 'A': {
				manager.login();
				break;
			}
			case 'a': {
				manager.login();
				break;
			}
			default: {
				cout << "æ— æ•ˆå­—ç¬¦!è¯·é‡æ–°è¾“å…¥!" << endl;
				break;
			}
		}
	}
	return 0;
}

```
## struct.h
```
#ifndef STRUCT_H
#define STRUCT_H

//ä¹¦ç±ä¿¡æ¯ç»“æ„ä½“
struct book {
	char book_name[25];
	char book_location[25];
	char book_author[15];
	int book_num = 1;
};

//å­¦ç”Ÿä¿¡æ¯ç»“æ„ä½“
struct students {
	char name[10];
	long long ID;
	char password[10];
	char ownbook_name[15];

};

//æ•™å¸ˆä¿¡æ¯ç»“æ„ä½“
struct teachers {
	char name[10];
	long long ID;
	char password[10];
	char ownbook_name[15];

};

//ç®¡ç†å‘˜ä¿¡æ¯ç»“æ„ä½“
struct admins {
	char name[10];
	long long ID;
	char password[10];
};

//é¦†é•¿ä¿¡æ¯ç»“æ„ä½“
struct directors {
	char ID[10];
	char password[10];
};
#endif
```
## basic.h
```
#ifndef BASIC_H
#define BASIC_H
#include <cstring>
#include "struct.h"

#include "manage.h"	//ä½¿ç”¨å‹å…ƒå‡½æ•°å¿…é¡»ï¼Ÿ
class Basic {
	protected:
		char *book_name;
		char *book_location;
		char *book_author;
		int book_num;
	public:
		Basic() {};
		~Basic() {
			delete[] book_name;
			delete[] book_location;
			delete[] book_author;
		}
		void booksearch();
};

class Books: public Basic {
	private:

	public:
		Books() {}
		~Books() {
			delete []book_name;
			delete []book_location;
		}
		friend void Manage::addbook();
		//ç®¡ç†ç±»å‹å…ƒå‡½æ•°æ·»åŠ ä¹¦ç±
};


class Students: public Basic {
	private:
		char *student_name;
		long long student_ID;
		char *student_password;
		char *ownbook_name;

	public:
		Students() {
			ownbook_name = new char[10];
			strcpy(ownbook_name, "-No Book-");
		}
		~Students() {	//ææ„å‡½æ•°ï¼Œé‡Šæ”¾ç©ºé—´
			delete []student_name;
			delete []ownbook_name;
		}
		void registered();
		//å­¦ç”Ÿæ³¨å†Œ
		void login();
		//å­¦ç”Ÿç™»å½•
		void choose();
		//é€‰æ‹©åŠŸèƒ½
		void borrow();
		//å€Ÿä¹¦
		void repay();
		//è¿˜ä¹¦
};

class Teachers: public Basic {
	private:
		char *teacher_name;
		long long teacher_ID;
		char *teacher_password;
		char *ownbook_name;

	public:
		Teachers() {
			ownbook_name = new char[10];
			strcpy(ownbook_name, "-No Book-");
		}
		~Teachers() {
			delete []teacher_name;
			delete []ownbook_name;
		}
		void registered();
		//æ•™å¸ˆæ³¨å†Œ
		void login();
		//æ•™å¸ˆç™»å½•
		void choose();
		//é€‰æ‹©åŠŸèƒ½
		void borrow();
		//å€Ÿä¹¦
		void repay();
		//è¿˜ä¹¦
};

#endif
```
## basic.cpp
```
#include <iostream>
#include <fstream>
#include <cstring>
#include <cmath>
#include "basic.h"
using namespace std;

//*******************************************************************************************************
//æœç´¢ä¹¦ç±ä¿¡æ¯
void Basic::booksearch() {
	fstream read;
	book searching;
	int m = 0;
	//ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ­¤ä¹¦ç±
	while (m == 0) {	//å½“æ­¤ä¹¦ç±ä¸å­˜åœ¨æ—¶ å¾ªç¯è¾“å…¥
		read.open("books.dat", ios::in | ios::binary);
		cout << "è¯·è¾“å…¥æƒ³æŸ¥æ‰¾çš„å›¾ä¹¦å:\t";
		char s[25];
		cin.getline(s, 25);
		book_name = new char[strlen(s) + 1];
		strcpy(book_name, s);
		while (!read.eof()) {
			if (!read)
				break;
			read.read((char *)&searching, sizeof(searching));
			if (!strcmp(book_name, searching.book_name)) {
				m = 1;
				cout << "ä¹¦ç±åç§°:\t" << searching.book_name << endl;
				cout << "ä¹¦ç±ä½œè€…:\t" << searching.book_author << endl;
				cout << "ä¹¦ç±ä½ç½®:\t" << searching.book_location << endl;
				cout << "å‰©ä½™æ•°é‡:\t" << searching.book_num << endl;
				break;	//æ— breakæ—¶ï¼Œåœ¨æœç´¢æ–‡ä»¶ä¸­æœ€åä¸€ä¸ªä¹¦ç±æ—¶ä¼šè¾“å‡ºä¸¤æ¬¡
			}
		}
		read.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****
		if (m == 0) {
			cout << "ä¹¦ç±ä¸å­˜åœ¨!è¯·é‡æ–°è¾“å…¥!" << endl;
		}
	}
}

//*******************************************************************************************************
//å­¦ç”Ÿæ³¨å†Œ
void Students::registered() {

	fstream write;	//å°†å­¦ç”Ÿæ³¨å†Œä¿¡æ¯å†™å…¥æ–‡ä»¶
	write.open("students_info.dat", ios::app | ios::binary);
	students registered;
	cout << "è¯·è¾“å…¥æ‚¨çš„å§“å:\t";
	cin.getline(registered.name, 10);
	cout << "è¯·è¾“å…¥æ‚¨çš„å­¦å·:\t";
	cin >> registered.ID;
	cin.ignore();
	cout << "è¯·è¾“å…¥å¯†ç :\t";
	cin.getline(registered.password, 10);
	char password[10];
	cout << "è¯·ç¡®è®¤å¯†ç :\t";
	cin.getline(password, 10);
	if (!strcmp(password, registered.password)) {
		write.write((char *)&registered, sizeof(registered));
		write.close();
		cout << "æ³¨å†ŒæˆåŠŸ!" << endl;
	} else {
		while (strcmp(password, registered.password)) {
			cout << "ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´ è¯·é‡æ–°è¾“å…¥:\t";
			cin.getline(password, 10);

		}
		if (!strcmp(password, registered.password)) {
			write.write((char *)&registered, sizeof(registered));
			write.close();
			cout << "æ³¨å†ŒæˆåŠŸ!" << endl;
		}
	}
}

//*******************************************************************************************************
//å­¦ç”Ÿç™»å½•
void Students::login() {
	fstream read;
	students login;
	int m = 0;
	//ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ­¤ç”¨æˆ·
	while (m == 0) {	//å½“ç”¨æˆ·IDä¸å­˜åœ¨æ—¶ å¾ªç¯è¾“å…¥
		read.open("students_info.dat", ios::in | ios::binary);
		cout << "è¯·è¾“å…¥æ‚¨çš„å­¦å·:\t";
		cin >> student_ID;
		cin.ignore();
		int n = 0;
		//ç”¨äºåˆ¤æ–­ç»ˆæ­¢å¾ªç¯
		while (!read.eof()) {
			read.read((char *)&login, sizeof(login));
			if (student_ID == login.ID) {
				m = 1;
				char s[10];
				cout << "è¯·è¾“å…¥å¯†ç :\t";

				while (n == 0) {
					cin >> s;
					cin.ignore();
					student_password = new char[strlen(s) + 1];
					strcpy(student_password, s);
					if (!strcmp(student_password, login.password)) {
						n = 1;
						cout << "\n********************************ç™»å½•æˆåŠŸ********************************" << endl;
						student_name = new char[strlen(login.name) + 1];
						strcpy(student_name, login.name);
						cout << login.name << "åŒå­¦ æ‚¨å¥½!" << endl;
						cout << "*****ä¸ªäººä¿¡æ¯*****" << endl;
						cout << "å§“å:\t" << login.name << endl;
						cout << "ID:\t" << login.ID << endl;
						cout << "å·²å€Ÿä¹¦ç±:\t" << login.ownbook_name << endl;
						choose();
					} else {
						cout << "å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•!" << endl;
					}
				}
			}
			if (n == 1) {
				break;
			}
			if (!read)
				break;
		}
		if (m == 0) {
			cout << "*************************ç”¨æˆ·ä¸å­˜åœ¨!è¯·é‡æ–°è¾“å…¥!*************************" << endl;
		}
		read.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****
	}
}

//*******************************************************************************************************
//æ•™å¸ˆæ³¨å†Œ
void Teachers::registered() {
	fstream write;
	//å°†æ•™å¸ˆæ³¨å†Œä¿¡æ¯å†™å…¥æ–‡ä»¶
	write.open("teachers_info.dat", ios::app | ios::binary);
	teachers registered;
	cout << "è¯·è¾“å…¥æ‚¨çš„å§“å:\t";
	cin.getline(registered.name, 10);
	cout << "è¯·è¾“å…¥æ‚¨çš„å·¥å·:\t";
	cin >> registered.ID;
	cin.ignore();
	cout << "è¯·è¾“å…¥å¯†ç :\t";
	cin.getline(registered.password, 10);
	char password[10];
	cout << "è¯·ç¡®è®¤å¯†ç :\t";
	cin.getline(password, 10);
	if (!strcmp(password, registered.password)) {
		write.write((char *)&registered, sizeof(registered));
		write.close();
		cout << "æ³¨å†ŒæˆåŠŸ!" << endl;
	} else {
		while (strcmp(password, registered.password)) {
			cout << "ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´ è¯·é‡æ–°è¾“å…¥:\t";
			cin.getline(password, 10);

		}
		if (!strcmp(password, registered.password)) {
			write.write((char *)&registered, sizeof(registered));
			write.close();
			cout << "æ³¨å†ŒæˆåŠŸ!" << endl;
		}
	}
}

//*******************************************************************************************************
//æ•™å¸ˆç™»å½•
void Teachers::login() {
	fstream read;
	teachers login;
	int m = 0;
	//ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ­¤ç”¨æˆ·
	while (m == 0) {	//å½“ç”¨æˆ·IDä¸å­˜åœ¨æ—¶ å¾ªç¯è¾“å…¥
		read.open("teachers_info.dat", ios::in | ios::binary);
		cout << "è¯·è¾“å…¥æ‚¨çš„å­¦å·:\t";
		cin >> teacher_ID;
		cin.ignore();
		int n = 0;
		//ç”¨äºåˆ¤æ–­ç»ˆæ­¢å¾ªç¯
		while (!read.eof()) {
			read.read((char *)&login, sizeof(login));
			if (teacher_ID == login.ID) {
				m = 1;
				char s[10];
				cout << "è¯·è¾“å…¥å¯†ç :\t";

				while (n == 0) {
					cin >> s;
					cin.ignore();
					teacher_password = new char[strlen(s) + 1];
					strcpy(teacher_password, s);
					if (!strcmp(teacher_password, login.password)) {
						n = 1;
						cout << "\n********************************ç™»å½•æˆåŠŸ********************************" << endl;
						teacher_name = new char[strlen(login.name) + 1];
						strcpy(teacher_name, login.name);
						cout << login.name << "åŒå­¦ æ‚¨å¥½!" << endl;
						cout << "*****ä¸ªäººä¿¡æ¯*****" << endl;
						cout << "å§“å:\t" << login.name << endl;
						cout << "ID:\t" << login.ID << endl;
						cout << "å·²å€Ÿä¹¦ç±:\t" << login.ownbook_name << endl;
						choose();
					} else {
						cout << "å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•!" << endl;
					}
				}
			}
			if (n == 1) {
				break;
			}
			if (!read)
				break;
		}
		if (m == 0) {
			cout << "*************************ç”¨æˆ·ä¸å­˜åœ¨!è¯·é‡æ–°è¾“å…¥!*************************" << endl;
		}
		read.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****
	}
}

//*******************************************************************************************************
//å­¦ç”Ÿé€‰æ‹©åŠŸèƒ½
void Students::choose() {
	char judge1;
	//åˆ¤æ–­åŠŸèƒ½
	while (1) {
		cout << "è¯·é€‰æ‹©:\t1.æŸ¥æ‰¾ä¹¦ç±" << endl;
		cout << "       \t2.å€Ÿé˜…ä¹¦ç±" << endl;
		cout << "       \t3.å½’è¿˜ä¹¦ç±" << endl;
		cout << "       \t4.ä¿®æ”¹å¯†ç " << endl;
		cout << "       \t0.é€€å‡ºç™»å½•" << endl;
		cin >> judge1;
		cin.ignore();
		switch (judge1) {
			case '1': {
				booksearch();
				break;
			}
			case '2': {
				borrow();
				break;
			}
			case '3': {
				repay();
				break;
			}
			case '0': {
				exit(0);
				break;
			}
			default: {

				break;
			}
		}
	}
}

//*******************************************************************************************************
//æ•™å¸ˆé€‰æ‹©åŠŸèƒ½
void Teachers::choose() {
	char judge1;
	//åˆ¤æ–­åŠŸèƒ½
	while (1) {
		cout << "è¯·é€‰æ‹©:\t1.æŸ¥æ‰¾ä¹¦ç±" << endl;
		cout << "       \t2.å€Ÿé˜…ä¹¦ç±" << endl;
		cout << "       \t3.å½’è¿˜ä¹¦ç±" << endl;
		cout << "       \t4.ä¿®æ”¹å¯†ç " << endl;
		cout << "       \t0.é€€å‡ºç™»å½•" << endl;
		cin >> judge1;
		cin.ignore();
		switch (judge1) {
			case '1': {
				booksearch();
				break;
			}
			case '2': {
				borrow();
				break;
			}
			case '3': {
				repay();
				break;
			}
			case '6': {
				exit(0);
				break;
			}
		}
	}
}

//*******************************************************************************************************
//å­¦ç”Ÿå€Ÿä¹¦å‡½æ•°
void Students::borrow() {
	fstream writefile;
	fstream readfile1;
	//è¯»å–books.dat
	fstream readfile2;
	//è¯»å–books_copy.dat
	book borrow;
	book mid1;
	//è¯»å–æ–‡ä»¶ï¼Œéå†ç»“æ„ä½“ä¸­çš„ä¹¦ç±å
	book mid2;
	//è¯»å–æ–‡ä»¶ï¼Œå­˜å‚¨éæ·»åŠ ä¹¦ç±çš„ç»“æ„ä½“
	students add_ownbook;
	//åœ¨æ–‡ä»¶é‡Œæ·»åŠ å€Ÿé˜…ä¹¦ç±ä¿¡æ¯
	for (int i = 0;; i++) {
		int m = 0;
		//åˆ¤æ–­ä¹¦ç±æ˜¯å¦å·²å­˜åœ¨
		cout << "è¯·è¾“å…¥è¦å€Ÿé˜…çš„ä¹¦ç±å:\t";
		cin >> borrow.book_name;
		cin.ignore();
		readfile1.open("books.dat", ios::in | ios::binary);
		while (!readfile1.eof()) {
			if (!readfile1)
				break;
			readfile1.read((char *)&mid1, sizeof mid1);
			if ((strcmp(mid1.book_name, borrow.book_name) == 0) && (mid1.book_num != 0)) {
				cout << "é¦†å†…ç°æœ‰ã€Š" << mid1.book_name << "ã€‹" << mid1.book_num << "æœ¬" << endl;
				m = 1;
				cout << "*****ä¹¦ç±ä¿¡æ¯*****\n" << endl;
				cout << "ä¹¦ç±åç§°:\t" << mid1.book_name << endl;
				cout << "ä¹¦ç±ä½œè€…:\t" << mid1.book_author << endl;
				cout << "ä¹¦ç±ä½ç½®:\t" << mid1.book_location << endl;
				cout << "æ˜¯å¦ç¡®å®šå€Ÿé˜…ï¼Ÿ(Y/N)" << endl;
				char judge;
				//åˆ¤æ–­æ˜¯å¦ç¡®å®šå€Ÿé˜…
				while (1) {
					int n = 0;
					//åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è·³å‡ºæ­¤whileå¾ªç¯
					cin >> judge;
					cin.ignore();
					switch (judge) {
						case 'Y': {
							n = 1;
							fstream borrow_read;
							fstream borrow_write;
							borrow_read.open("students_info.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								if (add_ownbook.ID == student_ID) {
									strcpy(add_ownbook.ownbook_name, borrow.book_name);
									borrow_write.open("students_info_copy.dat", ios::out | ios::binary);
									borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
									borrow_write.close();
								}
							}
							borrow_read.close();
							borrow_read.open("students_info.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								if (add_ownbook.ID != student_ID) {
									borrow_write.open("students_info_copy.dat", ios::app | ios::binary);
									borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
									borrow_write.close();
								}
							}
							borrow_read.close();
							borrow_read.open("students_info.dat", ios::out);
							borrow_read.close();
							borrow_read.open("students_info_copy.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								borrow_write.open("students_info.dat", ios::app | ios::binary);
								borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
								borrow_write.close();
							}
							borrow_read.close();
							mid1.book_num--;
							writefile.open("books_copy.dat", ios::out | ios::binary);
							writefile.write((char *)&mid1, sizeof mid1);
							writefile.clear();
							writefile.close();
							break;
						}
						case 'y': {
							n = 1;
							fstream borrow_read;
							fstream borrow_write;
							borrow_read.open("students_info.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								if (add_ownbook.ID == student_ID) {
									strcpy(add_ownbook.ownbook_name, borrow.book_name);
									borrow_write.open("students_info_copy.dat", ios::out | ios::binary);
									borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
									borrow_write.close();
								}
							}
							borrow_read.close();
							borrow_read.open("students_info.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								if (add_ownbook.ID != student_ID) {
									borrow_write.open("students_info_copy.dat", ios::app | ios::binary);
									borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
									borrow_write.close();
								}
							}
							borrow_read.close();
							borrow_read.open("students_info.dat", ios::out);
							borrow_read.close();
							borrow_read.open("students_info_copy.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								borrow_write.open("students_info.dat", ios::app | ios::binary);
								borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
								borrow_write.close();
							}
							borrow_read.close();
							mid1.book_num--;
							writefile.open("books_copy.dat", ios::out | ios::binary);
							writefile.write((char *)&mid1, sizeof mid1);
							writefile.clear();
							writefile.close();
							break;
						}
						case 'N': {
							n = 1;
							break;
						}
						case 'n': {
							n = 1;
							break;
						}
						default: {
							cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥:\t";
							break;
						}
					}
					if (n == 1)
						break;
				}
				break;
			}
		}
		readfile1.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****
		if (m == 1) {
			readfile1.open("books.dat", ios::in | ios::binary);
			while (!readfile1.eof()) {
				if (!readfile1)
					break;
				readfile1.read((char *)&mid2, sizeof mid2);
				if (strcmp(mid2.book_name, borrow.book_name)) {
					writefile.open("books_copy.dat", ios::app | ios::binary);
					writefile.write((char *)&mid2, sizeof mid2);
					writefile.clear();
					writefile.close();
				}
			}
			readfile1.close();
			readfile1.open("books.dat", ios::out);
			readfile1.close();
			readfile2.open("books_copy.dat", ios::in | ios::binary);
			while (!readfile2.eof()) {
				if (!readfile2)
					break;
				readfile2.read((char *)&mid2, sizeof mid2);
				writefile.open("books.dat", ios::app | ios::binary);
				writefile.write((char *)&mid2, sizeof mid2);
				writefile.clear();
				writefile.close();
			}
			readfile2.close();
		}

		else if (m == 0) {	//é¦†å†…æš‚æ— è¯¥ä¹¦ç±æ—¶
			cout << "é¦†å†…æš‚æ— ã€Š" << borrow.book_name << "ã€‹" << endl;
		}
		cout << "æ˜¯å¦è¦ç»§ç»­å€Ÿé˜…(Y/N):\t";
		char judge1;
		//åˆ¤æ–­æ˜¯å¦è¿›è¡Œä¸‹ä¸€æ¬¡æ·»åŠ 
		int judge2 = 1;
		//åˆ¤æ–­è¾“å…¥å­—ç¬¦æœ‰æ•ˆæ€§
		while (judge2) {
			cin >> judge1;
			cin.ignore();
			if (judge1 == 'Y' || judge1 == 'y')
				judge2 = 0;
			else if (judge1 == 'N' || judge1 == 'n')
				judge2 = 0;
			else
				cout << "è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥:\n";
		}
		if (judge1 == 'Y' || judge1 == 'y')
			continue;
		else if (judge1 == 'N' || judge1 == 'n')
			break;
	}
}

//*******************************************************************************************************
//æ•™å¸ˆå€Ÿä¹¦å‡½æ•°
void Teachers::borrow() {
	fstream writefile;
	fstream readfile1;
	//è¯»å–books.dat
	fstream readfile2;
	//è¯»å–books_copy.dat
	book borrow;
	book mid1;
	//è¯»å–æ–‡ä»¶ï¼Œéå†ç»“æ„ä½“ä¸­çš„ä¹¦ç±å
	book mid2;
	//è¯»å–æ–‡ä»¶ï¼Œå­˜å‚¨éæ·»åŠ ä¹¦ç±çš„ç»“æ„ä½“
	teachers add_ownbook;
	//åœ¨æ–‡ä»¶é‡Œæ·»åŠ å€Ÿé˜…ä¹¦ç±ä¿¡æ¯
	for (int i = 0;; i++) {
		int m = 0;
		//åˆ¤æ–­ä¹¦ç±æ˜¯å¦å·²å­˜åœ¨
		cout << "è¯·è¾“å…¥è¦å€Ÿé˜…çš„ä¹¦ç±å:\t";
		cin >> borrow.book_name;
		cin.ignore();
		readfile1.open("books.dat", ios::in | ios::binary);
		while (!readfile1.eof()) {
			if (!readfile1)
				break;
			readfile1.read((char *)&mid1, sizeof mid1);
			if ((strcmp(mid1.book_name, borrow.book_name) == 0) && (mid1.book_num != 0)) {
				cout << "é¦†å†…ç°æœ‰ã€Š" << mid1.book_name << "ã€‹" << mid1.book_num << "æœ¬" << endl;
				m = 1;
				cout << "*****ä¹¦ç±ä¿¡æ¯*****\n" << endl;
				cout << "ä¹¦ç±åç§°:\t" << mid1.book_name << endl;
				cout << "ä¹¦ç±ä½œè€…:\t" << mid1.book_author << endl;
				cout << "ä¹¦ç±ä½ç½®:\t" << mid1.book_location << endl;
				cout << "æ˜¯å¦ç¡®å®šå€Ÿé˜…ï¼Ÿ(Y/N)" << endl;
				char judge;
				//åˆ¤æ–­æ˜¯å¦ç¡®å®šå€Ÿé˜…
				while (1) {
					int n = 0;
					//åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è·³å‡ºæ­¤whileå¾ªç¯
					cin >> judge;
					cin.ignore();
					switch (judge) {
						case 'Y': {
							n = 1;
							fstream borrow_read;
							fstream borrow_write;
							borrow_read.open("teachers_info.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								if (add_ownbook.ID == teacher_ID) {
									strcpy(add_ownbook.ownbook_name, borrow.book_name);
									borrow_write.open("teachers_info_copy.dat", ios::out | ios::binary);
									borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
									borrow_write.close();
								}
							}
							borrow_read.close();
							borrow_read.open("teachers_info.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								if (add_ownbook.ID != teacher_ID) {
									borrow_write.open("teachers_info_copy.dat", ios::app | ios::binary);
									borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
									borrow_write.close();
								}
							}
							borrow_read.close();
							borrow_read.open("teachers_info.dat", ios::out);
							borrow_read.close();
							borrow_read.open("teachers_info_copy.dat", ios::in | ios::binary);
							while (!borrow_read.eof()) {
								if (!borrow_read)
									break;
								borrow_read.read((char *)&add_ownbook, sizeof add_ownbook);
								borrow_write.open("teachers_info.dat", ios::app | ios::binary);
								borrow_write.write((char *)&add_ownbook, sizeof add_ownbook);
								borrow_write.close();
							}
							borrow_read.close();
							mid1.book_num--;
							writefile.open("books_copy.dat", ios::out | ios::binary);
							writefile.write((char *)&mid1, sizeof mid1);
							writefile.clear();
							writefile.close();
							break;
						}
						case 'y': {

							break;
						}
						case 'N': {
							n = 1;
							break;
						}
						case 'n': {
							n = 1;
							break;
						}
						default: {
							cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥:\t";
							break;
						}
					}
					if (n == 1)
						break;
				}
				break;
			}
		}
		readfile1.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****
		if (m == 1) {
			readfile1.open("books.dat", ios::in | ios::binary);
			while (!readfile1.eof()) {
				if (!readfile1)
					break;
				readfile1.read((char *)&mid2, sizeof mid2);
				if (strcmp(mid2.book_name, borrow.book_name)) {
					writefile.open("books_copy.dat", ios::app | ios::binary);
					writefile.write((char *)&mid2, sizeof mid2);
					writefile.clear();
					writefile.close();
				}
			}
			readfile1.close();
			readfile1.open("books.dat", ios::out);
			readfile1.close();
			readfile2.open("books_copy.dat", ios::in | ios::binary);
			while (!readfile2.eof()) {
				if (!readfile2)
					break;
				readfile2.read((char *)&mid2, sizeof mid2);
				writefile.open("books.dat", ios::app | ios::binary);
				writefile.write((char *)&mid2, sizeof mid2);
				writefile.clear();
				writefile.close();
			}
			readfile2.close();
		}

		else if (m == 0) {	//é¦†å†…æš‚æ— è¯¥ä¹¦ç±æ—¶
			cout << "é¦†å†…æš‚æ— ã€Š" << borrow.book_name << "ã€‹" << endl;
		}
		cout << "æ˜¯å¦è¦ç»§ç»­å€Ÿé˜…(Y/N):\t";
		char judge1;
		//åˆ¤æ–­æ˜¯å¦è¿›è¡Œä¸‹ä¸€æ¬¡æ·»åŠ 
		int judge2 = 1;
		//åˆ¤æ–­è¾“å…¥å­—ç¬¦æœ‰æ•ˆæ€§
		while (judge2) {
			cin >> judge1;
			cin.ignore();
			if (judge1 == 'Y' || judge1 == 'y')
				judge2 = 0;
			else if (judge1 == 'N' || judge1 == 'n')
				judge2 = 0;
			else
				cout << "è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥:\n";
		}
		if (judge1 == 'Y' || judge1 == 'y')
			continue;
		else if (judge1 == 'N' || judge1 == 'n')
			break;
	}
}

//*******************************************************************************************************
//å­¦ç”Ÿè¿˜ä¹¦
void Students::repay() {
	fstream readfile1;
	fstream readfile2;
	fstream writefile;
	book reply;
	book mid1;
	book mid2;
	students del_ownbook;
	for (int i = 0;; i++) {
		int m = 0;
		//åˆ¤æ–­ä¹¦ç±æ˜¯å¦å·²å­˜åœ¨
		cout << "è¯·è¾“å…¥è¦å½’è¿˜çš„ä¹¦ç±å:\t";
		cin >> reply.book_name;
		cin.ignore();
		readfile1.open("books.dat", ios::in | ios::binary);
		while (!readfile1.eof()) {
			if (!readfile1)
				break;
			readfile1.read((char *)&mid1, sizeof mid1);
			if (strcmp(mid1.book_name, reply.book_name) == 0) {
				cout << "é¦†å†…ç°æœ‰ã€Š" << mid1.book_name << "ã€‹" << mid1.book_num << "æœ¬" << endl;
				m = 1;
				cout << "*****ä¹¦ç±ä¿¡æ¯*****\n" << endl;
				cout << "ä¹¦ç±åç§°:\t" << mid1.book_name << endl;
				cout << "ä¹¦ç±ä½œè€…:\t" << mid1.book_author << endl;
				cout << "ä¹¦ç±ä½ç½®:\t" << mid1.book_location << endl;
				cout << "æ˜¯å¦ç¡®å®šå½’è¿˜ï¼Ÿ(Y/N)" << endl;
				char judge;
				//åˆ¤æ–­æ˜¯å¦ç¡®å®šå½’è¿˜
				while (1) {
					int n = 0;
					//åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è·³å‡ºæ­¤whileå¾ªç¯
					cin >> judge;
					cin.ignore();
					switch (judge) {
						case 'Y': {
							n = 1;
							fstream reply_read;
							fstream reply_write;
							reply_read.open("students_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID == student_ID) {
									strcpy(del_ownbook.ownbook_name, "No Book");
									reply_write.open("students_info_copy.dat", ios::out | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("students_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID != student_ID) {
									reply_write.open("students_info_copy.dat", ios::app | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("students_info.dat", ios::out);
							reply_read.close();
							reply_read.open("students_info_copy.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.open("students_info.dat", ios::app | ios::binary);
								reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.close();
							}
							reply_read.close();
							mid1.book_num++;
							writefile.open("books_copy.dat", ios::out | ios::binary);
							writefile.write((char *)&mid1, sizeof mid1);
							writefile.clear();
							writefile.close();
							break;
						}
						case 'y': {
							n = 1;
							fstream reply_read;
							fstream reply_write;
							reply_read.open("students_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID == student_ID) {
									strcpy(del_ownbook.ownbook_name, "No Book");
									reply_write.open("students_info_copy.dat", ios::out | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("students_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID != student_ID) {
									reply_write.open("students_info_copy.dat", ios::app | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("students_info.dat", ios::out);
							reply_read.close();
							reply_read.open("students_info_copy.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.open("students_info.dat", ios::app | ios::binary);
								reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.close();
							}
							reply_read.close();
							mid1.book_num++;
							writefile.open("books_copy.dat", ios::out | ios::binary);
							writefile.write((char *)&mid1, sizeof mid1);
							writefile.clear();
							writefile.close();
							break;
						}
						case 'N': {
							n = 1;
							break;
						}
						case 'n': {
							n = 1;
							break;
						}
						default: {
							cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥:\t";
							break;
						}
					}
					if (n == 1)
						break;
				}
				break;
			}
		}
		readfile1.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****
		if (m == 1) {
			readfile1.open("books.dat", ios::in | ios::binary);
			while (!readfile1.eof()) {
				if (!readfile1)
					break;
				readfile1.read((char *)&mid2, sizeof mid2);
				if (strcmp(mid2.book_name, reply.book_name)) {
					writefile.open("books_copy.dat", ios::app | ios::binary);
					writefile.write((char *)&mid2, sizeof mid2);
					writefile.clear();
					writefile.close();
				}
			}
			readfile1.close();
			readfile1.open("books.dat", ios::out);
			readfile1.close();
			readfile2.open("books_copy.dat", ios::in | ios::binary);
			while (!readfile2.eof()) {
				if (!readfile2)
					break;
				readfile2.read((char *)&mid2, sizeof mid2);
				writefile.open("books.dat", ios::app | ios::binary);
				writefile.write((char *)&mid2, sizeof mid2);
				writefile.clear();
				writefile.close();
			}
			readfile2.close();
		}

		cout << "æ˜¯å¦è¦ç»§ç»­å½’è¿˜(Y/N):\t";
		char judge1;
		//åˆ¤æ–­æ˜¯å¦è¿›è¡Œä¸‹ä¸€æ¬¡æ·»åŠ 
		int judge2 = 1;
		//åˆ¤æ–­è¾“å…¥å­—ç¬¦æœ‰æ•ˆæ€§
		while (judge2) {
			cin >> judge1;
			cin.ignore();
			if (judge1 == 'Y' || judge1 == 'y')
				judge2 = 0;
			else if (judge1 == 'N' || judge1 == 'n')
				judge2 = 0;
			else
				cout << "è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥:\n";
		}
		if (judge1 == 'Y' || judge1 == 'y')
			continue;
		else if (judge1 == 'N' || judge1 == 'n')
			break;
	}
}

//*******************************************************************************************************
//æ•™å¸ˆè¿˜ä¹¦
void Teachers::repay() {
	fstream readfile1;
	fstream readfile2;
	fstream writefile;
	book reply;
	book mid1;
	book mid2;
	teachers del_ownbook;
	for (int i = 0;; i++) {
		int m = 0;
		//åˆ¤æ–­ä¹¦ç±æ˜¯å¦å·²å­˜åœ¨
		cout << "è¯·è¾“å…¥è¦å½’è¿˜çš„ä¹¦ç±å:\t";
		cin >> reply.book_name;
		cin.ignore();
		readfile1.open("books.dat", ios::in | ios::binary);
		while (!readfile1.eof()) {
			if (!readfile1)
				break;
			readfile1.read((char *)&mid1, sizeof mid1);
			if (strcmp(mid1.book_name, reply.book_name) == 0) {
				cout << "é¦†å†…ç°æœ‰ã€Š" << mid1.book_name << "ã€‹" << mid1.book_num << "æœ¬" << endl;
				m = 1;
				cout << "*****ä¹¦ç±ä¿¡æ¯*****\n" << endl;
				cout << "ä¹¦ç±åç§°:\t" << mid1.book_name << endl;
				cout << "ä¹¦ç±ä½œè€…:\t" << mid1.book_author << endl;
				cout << "ä¹¦ç±ä½ç½®:\t" << mid1.book_location << endl;
				cout << "æ˜¯å¦ç¡®å®šå½’è¿˜ï¼Ÿ(Y/N)" << endl;
				char judge;
				//åˆ¤æ–­æ˜¯å¦ç¡®å®šå½’è¿˜
				while (1) {
					int n = 0;
					//åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è·³å‡ºæ­¤whileå¾ªç¯
					cin >> judge;
					cin.ignore();
					switch (judge) {
						case 'Y': {
							n = 1;
							fstream reply_read;
							fstream reply_write;
							reply_read.open("teachers_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID == teacher_ID) {
									strcpy(del_ownbook.ownbook_name, "No Book");
									reply_write.open("teachers_info_copy.dat", ios::out | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("teachers_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID != teacher_ID) {
									reply_write.open("teachers_info_copy.dat", ios::app | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("teachers_info.dat", ios::out);
							reply_read.close();
							reply_read.open("teachers_info_copy.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.open("teachers_info.dat", ios::app | ios::binary);
								reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.close();
							}
							reply_read.close();
							mid1.book_num++;
							writefile.open("books_copy.dat", ios::out | ios::binary);
							writefile.write((char *)&mid1, sizeof mid1);
							writefile.clear();
							writefile.close();
							break;
						}
						case 'y': {
							n = 1;
							fstream reply_read;
							fstream reply_write;
							reply_read.open("teachers_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID == teacher_ID) {
									strcpy(del_ownbook.ownbook_name, "No Book");
									reply_write.open("teachers_info_copy.dat", ios::out | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("teachers_info.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								if (del_ownbook.ID != teacher_ID) {
									reply_write.open("teachers_info_copy.dat", ios::app | ios::binary);
									reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
									reply_write.close();
								}
							}
							reply_read.close();
							reply_read.open("teachers_info.dat", ios::out);
							reply_read.close();
							reply_read.open("teachers_info_copy.dat", ios::in | ios::binary);
							while (!reply_read.eof()) {
								if (!reply_read)
									break;
								reply_read.read((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.open("teachers_info.dat", ios::app | ios::binary);
								reply_write.write((char *)&del_ownbook, sizeof del_ownbook);
								reply_write.close();
							}
							reply_read.close();
							mid1.book_num++;
							writefile.open("books_copy.dat", ios::out | ios::binary);
							writefile.write((char *)&mid1, sizeof mid1);
							writefile.clear();
							writefile.close();
							break;
						}
						case 'N': {
							n = 1;
							break;
						}
						case 'n': {
							n = 1;
							break;
						}
						default: {
							cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥:\t";
							break;
						}
					}
					if (n == 1)
						break;
				}
				break;
			}
		}
		readfile1.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****
		if (m == 1) {
			readfile1.open("books.dat", ios::in | ios::binary);
			while (!readfile1.eof()) {
				if (!readfile1)
					break;
				readfile1.read((char *)&mid2, sizeof mid2);
				if (strcmp(mid2.book_name, reply.book_name)) {
					writefile.open("books_copy.dat", ios::app | ios::binary);
					writefile.write((char *)&mid2, sizeof mid2);
					writefile.clear();
					writefile.close();
				}
			}
			readfile1.close();
			readfile1.open("books.dat", ios::out);
			readfile1.close();
			readfile2.open("books_copy.dat", ios::in | ios::binary);
			while (!readfile2.eof()) {
				if (!readfile2)
					break;
				readfile2.read((char *)&mid2, sizeof mid2);
				writefile.open("books.dat", ios::app | ios::binary);
				writefile.write((char *)&mid2, sizeof mid2);
				writefile.clear();
				writefile.close();
			}
			readfile2.close();
		}

		cout << "æ˜¯å¦è¦ç»§ç»­å½’è¿˜(Y/N):\t";
		char judge1;
		//åˆ¤æ–­æ˜¯å¦è¿›è¡Œä¸‹ä¸€æ¬¡æ·»åŠ 
		int judge2 = 1;
		//åˆ¤æ–­è¾“å…¥å­—ç¬¦æœ‰æ•ˆæ€§
		while (judge2) {
			cin >> judge1;
			cin.ignore();
			if (judge1 == 'Y' || judge1 == 'y')
				judge2 = 0;
			else if (judge1 == 'N' || judge1 == 'n')
				judge2 = 0;
			else
				cout << "è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥:\n";
		}
		if (judge1 == 'Y' || judge1 == 'y')
			continue;
		else if (judge1 == 'N' || judge1 == 'n')
			break;
	}
}
```
## manage.h
```
#ifndef MANAGE_H
#define MANAGE_H

#include "struct.h"
class Manage {
	protected:

	public:
		~Manage() {}
		void addbook();
		void login();
		void searchperson();
};

class Admins: public Manage {
	private:
		char *admin_name;
		char *admin_password;
		long long admin_ID;
	public:
		Admins() {}
		~Admins() {
			delete []admin_name;
			delete []admin_password;
		}
		void choose();

};

class Directors: public Manage {
	private:

	public:
		void addadmin();
		void deladmin();
		void changeID();
		void changepassword();
		void choose();
};

#endif
```
## manage.cpp
```c++
#include <iostream>
#include <fstream>
#include <cstring>
#include <cmath>
#include <stdlib.h>
#include "manage.h"
#include "basic.h"
using namespace std;

//*******************************************************************************************************
//ç®¡ç†è€…ç™»å½•
void Manage::login() {
	Admins admin;
	Directors director;
	cout << "*********************************è¯·ç™»å½•*********************************" << endl;
	cout << "è¯·è¾“å…¥ID:\t";
	char director_ID[10];
	char manage_password[10];

	while (1) {
		cin >> director_ID;
		cin.ignore();
		fstream read;
		directors d_login;
		admins a_login;
		read.open("director_info.dat", ios::in | ios::binary);
		int m = 0;
		//åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦ä¸ºé¦†é•¿ID
		int n = 0;
		//åˆ¤æ–­é¦†é•¿æ˜¯å¦ç™»å½•æˆåŠŸ
		int o = 0;
		//åˆ¤æ–­ç”¨æˆ·åIDæ˜¯å¦ä¸ºç®¡ç†å‘˜ID
		while (!read.eof()) {
			if (!read)
				break;
			read.read((char *)&d_login, sizeof d_login);
			if (!strcmp(director_ID, d_login.ID)) {
				m = 1;
				cout << "è¯·è¾“å…¥é¦†é•¿å¯†ç :\t";
				while (1) {
					cin >> manage_password;
					cin.ignore();
					if (!strcmp(manage_password, d_login.password)) {
						n = 1;
						cout << "\n********************************ç™»å½•æˆåŠŸ********************************" << endl;
						cout << "é¦†é•¿æ‚¨å¥½!" << endl;
						director.choose();
						break;
					} else {
						cout << "é¦†é•¿å¯†ç é”™è¯¯! è¯·é‡æ–°è¾“å…¥:\t";
						continue;
					}
				}
				if (n == 1)
					break;
			}
			if (m == 0)
				break;
		}
		read.close();
		if (m == 0) {
			long long admin_ID = 0;
			for (int j = 0; j < strlen(director_ID); j++) {
				admin_ID = admin_ID + ((int)director_ID[j] - 48) * pow(10, strlen(director_ID) - j - 1);
			}
			read.open("admins_info.dat", ios::in | ios::binary);
			while (!read.eof()) {
				if (!read)
					break;
				read.read((char *)&a_login, sizeof a_login);
				if (admin_ID == a_login.ID) {
					o = 1;
					cout << "è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç :\t";
					while (1) {
						cin >> manage_password;
						cin.ignore();
						if (!strcmp(manage_password, a_login.password)) {
							cout << "\n********************************ç™»å½•æˆåŠŸ********************************" << endl;
							cout << a_login.name << "ç®¡ç†å‘˜æ‚¨å¥½!" << endl;
							admin.choose();
							break;
						} else {
							cout << "ç®¡ç†å‘˜å¯†ç é”™è¯¯! è¯·é‡æ–°è¾“å…¥:\t";
							continue;
						}
					}
				}
			}
		}
		if (m == 0 && o == 0) {
			cout << "æ­¤ç®¡ç†ä¸å­˜åœ¨! è¯·é‡æ–°è¾“å…¥:\t";
			continue;
		}
	}
}


//*******************************************************************************************************
//é¦†é•¿é€‰æ‹©åŠŸèƒ½
void Directors::choose() {
	Basic basic;
	char judge2;	//é€‰æ‹©åŠŸèƒ½
	while (1) {
		cout << "\nè¯·é€‰æ‹©:1.-----æŸ¥æ‰¾ä¹¦ç±" << endl;
		cout << "       2.-----æ·»åŠ ä¹¦ç±" << endl;
		cout << "       3.-----æŸ¥æ‰¾å­¦ç”Ÿ/æ•™å¸ˆ" << endl;
		cout << "       4.-----æ·»åŠ ç®¡ç†å‘˜" << endl;
		cout << "       5.-----åˆ é™¤ç®¡ç†å‘˜" << endl;
		cout << "       6.-----ä¿®æ”¹ç™»å½•å" << endl;
		cout << "       7.-----ä¿®æ”¹å¯†ç " << endl;
		cout << "       0.-----é€€å‡ºç™»å½•" << endl;
		cin >> judge2;
		cin.ignore();
		switch (judge2) {
			case '1': {
				basic.booksearch();
				break;
			}
			case '2': {
				addbook();
				break;
			}
			case '3': {
				searchperson();
				break;
			}
			case '4': {
				addadmin();
				break;
			}
			case '5': {
				deladmin();
				break;
			}
			case '6': {

				break;
			}
			case '0': {
				exit(0);
				break;
			}
			default: {
				cout << "è¾“å…¥å­—ç¬¦æ— æ•ˆ!è¯·é‡æ–°è¾“å…¥!" << endl;
				break;
			}
		}
	}

}

//*******************************************************************************************************
//ç®¡ç†å‘˜é€‰æ‹©åŠŸèƒ½
void Admins::choose() {
	Basic basic;
	char judge2;	//é€‰æ‹©åŠŸèƒ½
	while (1) {
		cout << "\nè¯·é€‰æ‹©:\t1.-----æŸ¥æ‰¾ä¹¦ç±" << endl;
		cout << "       \t2.-----æŸ¥æ‰¾å­¦ç”Ÿ/æ•™å¸ˆä¿¡æ¯" << endl;
		cout << "       \t3.-----ä¿®æ”¹ç™»å½•å" << endl;
		cout << "       \t4.-----ä¿®æ”¹å¯†ç " << endl;
		cout << "       \t0.-----é€€å‡ºç™»å½•" << endl;
		cin >> judge2;
		cin.ignore();
		switch (judge2) {
			case '1': {
				basic.booksearch();
				break;
			}
			case '2': {
				searchperson();
				break;
			}
			case '3': {

				break;
			}
			case '0': {
				exit(0);
				break;
			}
			default: {
				cout << "è¾“å…¥å­—ç¬¦æ— æ•ˆ!è¯·é‡æ–°è¾“å…¥!" << endl;
				break;
			}
		}
	}
}

//*******************************************************************************************************
//ç®¡ç†è€…æ·»åŠ ä¹¦ç±
void Manage::addbook() {
	fstream writefile;
	fstream readfile0;
	//éªŒè¯books.datæ˜¯å¦å­˜åœ¨
	fstream readfile1;
	//è¯»å–books.dat
	fstream readfile2;
	//è¯»å–books_copy.dat
	book adding;
	book mid1;
	//è¯»å–æ–‡ä»¶ï¼Œéå†ç»“æ„ä½“ä¸­çš„ä¹¦ç±å
	book mid2;
	//è¯»å–æ–‡ä»¶ï¼Œå­˜å‚¨éæ·»åŠ ä¹¦ç±çš„ç»“æ„ä½“

	readfile0.open("books.dat", ios::in);
	//å½“books.datä¸å­˜åœ¨æ—¶ï¼Œæ–°å»ºæ–‡ä»¶
	if (!readfile0) {
		readfile1.open("books.dat", ios::out);
		cout << "books.datåˆ›å»ºæˆåŠŸ!" << endl;
		readfile1.close();
	}
	readfile0.close();

	for (int i = 0;; i++) {
		int m = 0;
		//åˆ¤æ–­ä¹¦ç±æ˜¯å¦å·²å­˜åœ¨
		cout << "è¯·è¾“å…¥è¦æ·»åŠ çš„ä¹¦ç±å:\t";
		cin >> adding.book_name;
		cin.ignore();
		readfile1.open("books.dat", ios::in | ios::binary);
		while (!readfile1.eof()) {
			if (!readfile1)
				break;
			readfile1.read((char *)&mid1, sizeof mid1);
			if (strcmp(mid1.book_name, adding.book_name) == 0) {
				cout << "é¦†å†…å·²å­˜åœ¨æ­¤ä¹¦ç±" << endl;
				m = 1;
				mid1.book_num++;
				cout << "ä¹¦ç±åç§°:\t" << mid1.book_name << endl;
				cout << "ä¹¦ç±ä½œè€…:\t" << mid1.book_author << endl;
				cout << "ä¹¦ç±ä½ç½®:\t" << mid1.book_location << endl;
				cout << "å‰©ä½™æ•°é‡:\t" << mid1.book_num << endl;
				writefile.open("books_copy.dat", ios::out | ios::binary);
				writefile.write((char *)&mid1, sizeof mid1);
				writefile.clear();
				writefile.close();
				break;
			}
		}
		readfile1.close();
		//*****æ³¨æ„å…³é—­æ–‡ä»¶ï¼æœªå…³é—­æ–‡ä»¶æ—¶æŒ‡é’ˆä¸€ç›´åœ¨æ–‡ä»¶ç»“å°¾*****

		if (m == 1) {
			readfile1.open("books.dat", ios::in | ios::binary);
			while (!readfile1.eof()) {
				if (!readfile1)
					break;
				readfile1.read((char *)&mid2, sizeof mid2);
				if (strcmp(mid2.book_name, adding.book_name) != 0) {
					writefile.open("books_copy.dat", ios::app | ios::binary);
					writefile.write((char *)&mid2, sizeof mid2);
					writefile.clear();
					writefile.close();

				}
			}
			readfile1.close();

			readfile1.open("books.dat", ios::out);
			readfile1.close();
			readfile2.open("books_copy.dat", ios::in | ios::binary);
			while (!readfile2.eof()) {
				if (!readfile2)
					break;
				readfile2.read((char *)&mid2, sizeof mid2);
				writefile.open("books.dat", ios::app | ios::binary);
				writefile.write((char *)&mid2, sizeof mid2);
				writefile.clear();
				writefile.close();
			}
			readfile2.close();
		}

		else if (m == 0) {	//é¦†å†…æœªæ·»åŠ è¯¥ä¹¦ç±æ—¶
			writefile.open("books.dat", ios::app | ios::binary);
			cout << "è¯·è¾“å…¥è¦æ·»åŠ çš„ä¹¦ç±ä½œè€…:\t";
			cin.getline(adding.book_author, 15);
			cout << "è¯·è¾“å…¥è¦æ·»åŠ çš„ä¹¦ç±æ‰€æ”¾ä½ç½®:\t";
			cin.getline(adding.book_location, 25);
			writefile.write((char *)&adding, sizeof(adding));
			writefile.clear();
			writefile.close();
		}
		cout << "æ˜¯å¦è¦ç»§ç»­æ·»åŠ (Y/N):\t";
		char judge1;
		//åˆ¤æ–­æ˜¯å¦è¿›è¡Œä¸‹ä¸€æ¬¡æ·»åŠ 
		int judge2 = 1;
		//åˆ¤æ–­è¾“å…¥å­—ç¬¦æœ‰æ•ˆæ€§
		while (judge2) {
			cin >> judge1;
			cin.ignore();
			if (judge1 == 'Y' || judge1 == 'y')
				judge2 = 0;
			else if (judge1 == 'N' || judge1 == 'n')
				judge2 = 0;
			else
				cout << "è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥:\n";
		}
		if (judge1 == 'Y' || judge1 == 'y')
			continue;
		else if (judge1 == 'N' || judge1 == 'n')
			break;
	}
}

//*******************************************************************************************************
//é¦†é•¿æ·»åŠ ç®¡ç†å‘˜
void Directors::addadmin() {
	fstream write;
	//å°†ç®¡ç†å‘˜ä¿¡æ¯å†™å…¥æ–‡ä»¶
	write.open("admins_info.dat", ios::app | ios::binary);
	admins add;
	cout << "è¯·è¾“å…¥æ·»åŠ çš„ç®¡ç†å‘˜å§“å:\t";
	cin >> add.name;
	cin.ignore();
	cout << "è¯·è¾“å…¥æ·»åŠ çš„ç®¡ç†å‘˜ID:\t";
	cin >> add.ID;
	cout << "è¯·ä¸ºæ·»åŠ çš„ç®¡ç†å‘˜åˆå§‹åŒ–å¯†ç :\t";
	cin >> add.password;
	cin.ignore();
	char password[10];
	cout << "è¯·ç¡®è®¤å¯†ç :\t";
	cin >> password;
	cin.ignore();
	if (strcmp(password, add.password) == 0) {
		write.write((char *)&add, sizeof(add));
		write.close();
		cout << "æ³¨å†ŒæˆåŠŸ!" << endl;
	} else {
		while (strcmp(password, add.password) != 0) {
			cout << "ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´ è¯·é‡æ–°è¾“å…¥:\t";
			cin >> password;
			cin.ignore();
		}
		if (!strcmp(password, add.password)) {
			write.write((char *)&add, sizeof(add));
			write.close();
			cout << "æ³¨å†ŒæˆåŠŸ!" << endl;
		}
	}
}
//*******************************************************************************************************
//é¦†é•¿åˆ é™¤ç®¡ç†å‘˜
void Directors::deladmin() {
	admins del;
	fstream read;
	fstream write;
	long long mid1;
	cout << "è¯·è¾“å…¥è¦åˆ é™¤çš„ç®¡ç†å‘˜ID:\t";
	cin >> mid1;
	read.open("admins_info.dat", ios::in | ios::binary);
	while (!read.eof()) {
		if (!read)
			break;
		read.read((char *)&del, sizeof del);
		if (mid1 == del.ID) {
			write.open("admins_info_copy.dat", ios::out);
			write.close();
		}
	}
	read.close();
	read.open("admins_info.dat", ios::in | ios::binary);
	while (!read.eof()) {
		if (!read)
			break;
		read.read((char *)&del, sizeof del);
		if (mid1 != del.ID) {
			write.open("admins_info_copy.dat", ios::app | ios::binary);
			write.write((char *)&del, sizeof del);
			write.close();
		}
	}
	read.close();
	write.open("admins_info.dat", ios::out);
	write.close();
	read.open("admins_info_copy.dat", ios::in | ios::binary);
	while (!read.eof()) {
		if (!read)
			break;
		read.read((char *)&del, sizeof del);
		write.open("admins_info.dat", ios::app | ios::binary);
		write.write((char *)&del, sizeof del);
		write.close();
	}
	read.close();
}

//*******************************************************************************************************
//æŸ¥æ‰¾å­¦ç”Ÿ/æ•™å¸ˆä¿¡æ¯
void Manage::searchperson() {
	char judge1;
	cout << "è¯·é€‰æ‹©æŸ¥æ‰¾çš„äººç‰©èº«ä»½(S/s-å­¦ç”Ÿ T/t-æ•™å¸ˆ):\t";
	cin >> judge1;
	cin.ignore();
	if (judge1 == 'S' || judge1 == 's') {
		cout << "è¯·è¾“å…¥æŸ¥æ‰¾æ–¹å¼:\t1.---å§“å" << endl;
		cout << "               \t2.---ID" << endl;
		char judge2;
		int judge3 = 0;
		cin >> judge2;
		switch (judge2) {
			case '1': {
				students search;
				char name[10];
				do {
					cout << "è¯·è¾“å…¥æŸ¥æ‰¾çš„å­¦ç”Ÿå§“å:\t";
					cin >> name;
					cin.ignore();
					fstream read;
					read.open("students_info.dat", ios::in | ios::binary);
					while (!read.eof()) {
						if (!read)
							break;
						read.read((char *)&search, sizeof search);
						if (!strcmp(search.name, name)) {
							judge3 = 1;
							cout << "å­¦ç”Ÿå§“å:      " << search.name << endl;
							cout << "å­¦ç”ŸID:        " << search.ID << endl;
							cout << "å­¦ç”Ÿæ‰€å€Ÿä¹¦ç±:  " << search.ownbook_name << endl;
							break;
						}
					}
					read.close();
					if (judge3 == 0) {
						cout << "æœªæ‰¾åˆ°ç”¨æˆ· " << name << "åŒå­¦" << endl;
						continue;
					}
				} while (0);
				break;
			}
			case '2': {
				students search;
				long long ID;
				do {
					cout << "è¯·è¾“å…¥æŸ¥æ‰¾çš„å­¦ç”ŸID:\t";
					cin >> ID;
					fstream read;
					read.open("students_info.dat", ios::in | ios::binary);
					while (!read.eof()) {
						if (!read)
							break;
						read.read((char *)&search, sizeof search);
						if (search.ID == ID) {
							judge3 = 1;
							cout << "å­¦ç”Ÿå§“å:      " << search.name << endl;
							cout << "å­¦ç”ŸID:        " << search.ID << endl;
							cout << "å­¦ç”Ÿæ‰€å€Ÿä¹¦ç±:  " << search.ownbook_name << endl;
							break;
						}
					}
					read.close();
					if (judge3 == 0) {
						cout << "æœªæ‰¾åˆ°ç”¨æˆ·IDä¸º " << ID << " çš„åŒå­¦" << endl;
						continue;
					}
				} while (0);
				break;
			}
			default: {
				cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥:" << endl;
				break;
			}
		}
	} else if (judge1 == 'T' || judge1 == 't') {
		cout << "è¯·è¾“å…¥æŸ¥æ‰¾æ–¹å¼:\t1.---å§“å" << endl;
		cout << "               \t2.---ID" << endl;
		char judge2;
		int judge3 = 0;
		cin >> judge2;
		switch (judge2) {
			case '1': {
				teachers search;
				char name[10];
				while (1) {
					cout << "è¯·è¾“å…¥æŸ¥æ‰¾çš„æ•™å¸ˆå§“å:\t";
					cin >> name;
					cin.ignore();
					fstream read;
					read.open("teachers_info.dat", ios::in | ios::binary);
					while (!read.eof()) {
						if (!read)
							break;
						read.read((char *)&search, sizeof search);
						if (!strcmp(search.name, name)) {
							judge3 = 1;
							cout << "æ•™å¸ˆå§“å:      " << search.name << endl;
							cout << "æ•™å¸ˆID:        " << search.ID << endl;
							cout << "æ•™å¸ˆæ‰€å€Ÿä¹¦ç±:  " << search.ownbook_name << endl;
							break;
						}
					}
					read.close();
					if (judge3 == 0) {
						cout << "æœªæ‰¾åˆ°ç”¨æˆ· " << name << "åŒå­¦" << endl;
						continue;
					}
				}
				break;
			}
			case '2': {
				teachers search;
				long long ID;
				do {
					cout << "è¯·è¾“å…¥æŸ¥æ‰¾çš„æ•™å¸ˆID:\t";
					cin >> ID;
					fstream read;
					read.open("teachers_info.dat", ios::in | ios::binary);
					while (!read.eof()) {
						if (!read)
							break;
						read.read((char *)&search, sizeof search);
						if (search.ID == ID) {
							judge3 = 1;
							cout << "æ•™å¸ˆå§“å:      " << search.name << endl;
							cout << "æ•™å¸ˆID:        " << search.ID << endl;
							cout << "æ•™å¸ˆæ‰€å€Ÿä¹¦ç±:  " << search.ownbook_name << endl;
							break;
						}
					}
					read.close();
					if (judge3 == 0) {
						cout << "æœªæ‰¾åˆ°ç”¨æˆ·IDä¸º " << ID << " çš„åŒå­¦" << endl;
						continue;
					}
				} while (0);
				break;
			}
			default: {
				cout << "æ— æ•ˆå­—ç¬¦! è¯·é‡æ–°è¾“å…¥:" << endl;
				break;
			}
		}
	}
}
```
> é¦†é•¿åˆå§‹ç™»å½•ä¿¡æ¯å°±å†™ä¸ªç¨‹åºå†™å…¥æ–‡ä»¶äº†

## change_director.cpp
```c++
#include<iostream>
#include<fstream>
using namespace std;
struct director{
	char ID[10];
	char password[10];
};
int main(){
	fstream write;
	director registered;
	cout<<"ID:"<<endl;
	cin>>registered.ID;
	cin.ignore();
	cin>>registered.password;
	cin.ignore();
	write.open("director_info.dat",ios::out|ios::binary);
	write.write((char *)&registered,sizeof registered);
	write.close();
	return 0;
}
```

